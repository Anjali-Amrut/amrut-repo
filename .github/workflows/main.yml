name: Create Jira Issue on Push
'on':
  - push
jobs:
  create-issue:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2  
        env:
          JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
          JIRA_USER_EMAIL: ${{ secrets.JIRA_USER_EMAIL }}
          JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}
      - name: Get commit message
        id: get-commit-message
        run: echo "COMMIT_MESSAGE=$(git log --format=%B -n 1 ${{ github.event.after }})" >> $GITHUB_ENV

      - name: Create Jira issue
        run: |
          curl --location '${{ secrets.JIRA_BASE_URL }}/rest/api/2/issue' \
          --header 'Content-Type:application/json' \
          --header 'Authorization:Basic ${{ secrets.JIRA_API_TOKEN }}' \
          --data '{
            "fields":{
              "description":"This issue is created by GitHub.",
              "issuetype":{
                "id":"10007"
              },
              "project":{
                "id":"10029"
              },
              "summary":"${{ env.COMMIT_MESSAGE }}",
              "reporter": {
                "accountId": "712020%3A2b99e9f5-f651-48aa-b2a7-7a225bdf7004"
             }
            }
          }'
